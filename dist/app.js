function randomInt(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function Bar(t){this.element=t,this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.levels=[.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5],this.angles=[];for(var e=0;e<this.levels.length;e++)this.angles.push(randomInt(0,2)-1);this.level=.5,this.height=this.canvas.height,this.width=this.canvas.width,this._angle=0}function Player(t,e){this.canvas=document.querySelector("#player"),this.canvas.width=t,this.canvas.height=e,this.c=this.canvas.getContext("2d"),this.life=100,this.pos={x:50,y:50},this.dir={x:0,y:0},this.radius=20,this.speed=1,this.angle=0,document.addEventListener("mousemove",function(t){if(!t.target!=this.canvas){var e=this.canvas.getBoundingClientRect();this.mouse={x:Math.round((t.clientX-e.left)/(e.right-e.left)*this.canvas.width),y:Math.round((t.clientY-e.top)/(e.bottom-e.top)*this.canvas.height)};var i=this._getDistance();this.dir={x:(this.mouse.x-this.pos.x)/i,y:(this.mouse.y-this.pos.y)/i};var s={x:this.pos.x+this.dir.x||0,y:this.pos.y+this.dir.y||0};this._getDistance(s)>this.radius&&this.checkPosition(s)&&this._updatePosition()}}.bind(this))}function App(){this.version="v0.0.1",this.author="Marco Stagni",this.canvas=document.querySelector("#game"),this.container=document.querySelector("#gameContainer"),this.c=this.canvas.getContext("2d"),this.canvas.height=2500,this.canvas.width=4900,this.step=100,this.margin=200,this.container.style.height=this.canvas.height+"px;",this.container.style.width=this.canvas.width+"px;",this.coffee=new Bar("coffee"),this.sleep=new Bar("sleep"),this.player=new Player(this.canvas.height,this.canvas.width),this.maze=this.createMaze(12,12),this.drawMaze(this.maze)}function render(){app.render(),app.renderid=requestAnimationFrame(render)}Bar.prototype={render:function(){this.ctx.clearRect(0,0,this.width,this.height);for(var t,e=5,i=15,s=0;s<this.levels.length;s++)t=this.levels[s]*this.height+5*Math.sin(this.angles[s]),this.ctx.fillStyle="rgb(255, 255, 255)",this.ctx.fillRect(i,this.height-t,e,t),i+=e+8,this.angles[s]+=.1;this.levels.shift(),this.levels.push(app[this.element].level),this._angle+=.1},inc:function(t){this.level+=t?t:.1},dec:function(t){this.level=this.level-(t?t:.1)}},Player.prototype={isAlive:function(){return this.life>0},_getDistance:function(t){var e=t||this.pos;return this.mouse?Math.round(Math.sqrt(Math.pow(e.x-this.mouse.x,2)+Math.pow(e.y-this.mouse.y,2))):0},_updatePosition:function(){this.pos.x+=this.dir.x||0,this.pos.y+=this.dir.y||0},checkPosition:function(t){var e=t||this.pos;if(e.x<10||e.x>this.canvas.width)return!1;if(e.y<10||e.y>this.canvas.height)return!1;var i=app.c.getImageData(e.x,e.y,4,4).data;return i.indexOf(85)==-1},render:function(){if(this._getDistance()>this.radius&&this.checkPosition()){this._updatePosition(),this.c.clearRect(0,0,this.canvas.width,this.canvas.height),this.c.beginPath();var t=this.radius+Math.sin(this.angle);this.c.arc(this.pos.x,this.pos.y,t,0,2*Math.PI,!1),this.c.fillStyle="blue",this.c.fill(),this.angle+=.05}}},App.prototype={printVersion:function(){var t=document.getElementById("version");t.innerText=this.version},createMaze:function(t,e){var i=t*e-1;if(i<0)return void alert("illegal maze dimensions");for(var s=[],h=0;h<t+1;h++)s[h]=[],verti=[];for(var h=0;h<t+1;h++)verti[h]=[],here=[Math.floor(Math.random()*t),Math.floor(Math.random()*e)],path=[here],unvisited=[];for(var h=0;h<t+2;h++){unvisited[h]=[];for(var n=0;n<e+1;n++)unvisited[h].push(h>0&&h<t+1&&n>0&&(h!=here[0]+1||n!=here[1]+1))}for(;0<i;){for(var a=[[here[0]+1,here[1]],[here[0],here[1]+1],[here[0]-1,here[1]],[here[0],here[1]-1]],r=[],h=0;h<4;h++)unvisited[a[h][0]+1][a[h][1]+1]&&r.push(a[h]);r.length?(i-=1,next=r[Math.floor(Math.random()*r.length)],unvisited[next[0]+1][next[1]+1]=!1,next[0]==here[0]?s[next[0]][(next[1]+here[1]-1)/2]=!0:verti[(next[0]+here[0]-1)/2][next[1]]=!0,path.push(here=next)):here=path.pop()}return{x:t,y:e,horiz:s,verti:verti}},drawMaze:function(t){var e=[],i={x:0,y:0};this.c.fillStyle="#555555";for(var s=0;s<2*t.x+1;s++){var h=[];if(0==s%2)for(var n=0;n<4*t.y+1;n++)0==n%4?(h[n]="+",this.c.fillRect(i.x,i.y,8,8),i.x+=this.step,this.c.moveTo(i.x,i.y)):s>0&&t.verti[s/2-1][Math.floor(n/4)]?(h[n]=" ",i.x+=this.step,this.c.moveTo(i.x,i.y)):(h[n]="-",this.c.fillRect(i.x-90,i.y,190,8),i.x+=this.step,this.c.moveTo(i.x,i.y));else for(var n=0;n<4*t.y+1;n++)0==n%4?n>0&&t.horiz[(s-1)/2][n/4-1]?(h[n]=" ",i.x+=this.step,this.c.moveTo(i.x,i.y)):(h[n]="|",this.c.fillRect(i.x,i.y-90,8,190),i.x+=this.step,this.c.moveTo(i.x,i.y)):(h[n]=" ",i.x+=this.step,this.c.moveTo(i.x,i.y));0==s&&(h[1]=h[2]=h[3]=" ",i.x+=this.step,this.c.moveTo(i.x,i.y)),2*t.x-1==s&&(h[4*t.y]=" ",i.x+=this.step,this.c.moveTo(i.x,i.y)),e.push(h.join("")+"\r\n"),i.x=0,i.y+=this.step}console.log(e.join(""))},check:function(){},render:function(){this.coffee.render(),this.sleep.render(),this.check(),this.player.render()}};var app;window.onload=function(){app=new App,app.printVersion(),render()};