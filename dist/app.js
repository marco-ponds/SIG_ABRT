function randomInt(t,i){return Math.floor(Math.random()*(i-t+1)+t)}function Bar(t){this.element=t,this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.levels=[.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5],this.angles=[];for(var i=0;i<this.levels.length;i++)this.angles.push(randomInt(0,2)-1);this.level=.5,this.height=this.canvas.height,this.width=this.canvas.width,this._angle=0}function createEnemies(t,i){this.canvas=document.querySelector("#enemies"),this.canvas.width=t,this.canvas.height=i,this.c=this.canvas.getContext("2d"),this.count=100,this.types=Object.keys(GLITCHES)}function Enemy(t){this.life=20,this.type=t,this.pos={x:Math.random()*(this.canvas.width-100)+100,y:Math.random()*(this.canvas.height-100)+100}}function Player(t,i){this.canvas=document.querySelector("#player"),this.canvas.width=t,this.canvas.height=i,this.c=this.canvas.getContext("2d"),this.life=100,this.hit=2,this.pos={x:50,y:50},this.dir={x:0,y:0},this.radius=20,this.speed=1,this.angle=0,document.addEventListener("mousemove",function(t){if(!t.target!=this.canvas){var i=this.canvas.getBoundingClientRect();this.mouse={x:Math.round((t.clientX-i.left)/(i.right-i.left)*this.canvas.width),y:Math.round((t.clientY-i.top)/(i.bottom-i.top)*this.canvas.height)};var e=this._getDistance();this.dir={x:(this.mouse.x-this.pos.x)/e,y:(this.mouse.y-this.pos.y)/e};var n={x:this.pos.x+this.dir.x||0,y:this.pos.y+this.dir.y||0};this._getDistance(n)>this.radius&&this.checkPosition(n)&&this._updatePosition()}}.bind(this))}function App(){this.version="v0.0.1",this.author="Marco Stagni",this.conversation=document.querySelector("#conversation"),this.printing=!1,this.queue=[],this.canvas=document.querySelector("#game"),this.container=document.querySelector("#gameContainer"),this._canvases=this.container.querySelectorAll("canvas"),this.c=this.canvas.getContext("2d"),this.canvas.height=2500,this.canvas.width=4900,this.step=100,this.margin=200,this.container.style.height=this.canvas.height+"px;",this.container.style.width=this.canvas.width+"px;",this.coffee=new Bar("coffee"),this.sleep=new Bar("sleep"),this.player=new Player(this.canvas.height,this.canvas.width),this.maze=this.createMaze(12,12),this.drawMaze(this.maze)}function render(){app.render(),app.renderid=requestAnimationFrame(render)}var GLITCHES={invert_color:{color:"red",shape:"triangle",effect:function(){}},lag:{color:"green",shape:"square",effect:function(){}},invisible:{color:"white",shape:"circle",effect:function(){}}},GLITCHES_HUMAN={tired:{blink:function(){},wavy:function(){},wtf:function(){}},excited:{fast:function(){},colors:function(){}}};Bar.prototype={render:function(){this.ctx.clearRect(0,0,this.width,this.height);for(var t,i=5,e=15,n=0;n<this.levels.length;n++)t=this.levels[n]*this.height+5*Math.sin(this.angles[n]),this.ctx.fillStyle="rgb(255, 255, 255)",this.ctx.fillRect(e,this.height-t,i,t),e+=i+8,this.angles[n]+=.1;this.levels.shift(),this.levels.push(app[this.element].level),this._angle+=.1},inc:function(t){this.level+=t?t:.1},dec:function(t){this.level=this.level-(t?t:.1)}},Enemy.prototype={isAlive:function(){return this.life>0}},Player.prototype={isAlive:function(){return this.life>0},_getDistance:function(t){var i=t||this.pos;return this.mouse?Math.round(Math.sqrt(Math.pow(i.x-this.mouse.x,2)+Math.pow(i.y-this.mouse.y,2))):0},_updatePosition:function(){var t=this.dir.x||0,i=this.dir.y||0;this.pos.x+=t,this.pos.y+=i,app.updateMaze(t,i)},checkPosition:function(t){var i=t||this.pos;if(i.x<10||i.x>this.canvas.width)return!1;if(i.y<10||i.y>this.canvas.height)return!1;var e=app.c.getImageData(i.x,i.y,4,4).data;return e.indexOf(85)==-1},render:function(){if(this._getDistance()>this.radius&&this.checkPosition()){this._updatePosition(),this.c.clearRect(0,0,this.canvas.width,this.canvas.height),this.c.beginPath();var t=this.radius+Math.sin(this.angle);this.c.arc(this.pos.x,this.pos.y,t,0,2*Math.PI,!1),this.c.fillStyle="blue",this.c.fill(),this.angle+=.05}}},App.prototype={printVersion:function(){var t=document.getElementById("version");t.innerText=this.version},say:function(t,i){function e(){if(n.innerHTML+=i[s],app.conversation.scrollTop=app.conversation.scrollHeight,s++,s<i.length)setTimeout(e,Math.round(80*Math.random()));else if(app.printing=!1,0!=app.queue.length){var t=app.queue.shift();app.say(t.o,t.m)}}if(this.printing)return void this.queue.push({o:t,m:i});var n=document.createElement("li");n.className=t,this.conversation.appendChild(n);var s=0;app.printing=!0,setTimeout(e,Math.round(80*Math.random()))},boot:function(){for(var t in BOOT)app.say(BOOT[t].o,BOOT[t].m)},intro:function(){for(var t in INTRO)app.say(INTRO[t].o,INTRO[t].m)},createMaze:function(t,i){var e=t*i-1;if(e<0)return void alert("illegal maze dimensions");for(var n=[],s=0;s<t+1;s++)n[s]=[],verti=[];for(var s=0;s<t+1;s++)verti[s]=[],here=[Math.floor(Math.random()*t),Math.floor(Math.random()*i)],path=[here],unvisited=[];for(var s=0;s<t+2;s++){unvisited[s]=[];for(var o=0;o<i+1;o++)unvisited[s].push(s>0&&s<t+1&&o>0&&(s!=here[0]+1||o!=here[1]+1))}for(;0<e;){for(var h=[[here[0]+1,here[1]],[here[0],here[1]+1],[here[0]-1,here[1]],[here[0],here[1]-1]],a=[],s=0;s<4;s++)unvisited[h[s][0]+1][h[s][1]+1]&&a.push(h[s]);a.length?(e-=1,next=a[Math.floor(Math.random()*a.length)],unvisited[next[0]+1][next[1]+1]=!1,next[0]==here[0]?n[next[0]][(next[1]+here[1]-1)/2]=!0:verti[(next[0]+here[0]-1)/2][next[1]]=!0,path.push(here=next)):here=path.pop()}return{x:t,y:i,horiz:n,verti:verti}},drawMaze:function(t){var i=[],e={x:0,y:0};this.c.fillStyle="#555555";for(var n=0;n<2*t.x+1;n++){var s=[];if(0==n%2)for(var o=0;o<4*t.y+1;o++)0==o%4?(s[o]="+",this.c.fillRect(e.x,e.y,8,8),e.x+=this.step,this.c.moveTo(e.x,e.y)):n>0&&t.verti[n/2-1][Math.floor(o/4)]?(s[o]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y)):(s[o]="-",this.c.fillRect(e.x-90,e.y,190,8),e.x+=this.step,this.c.moveTo(e.x,e.y));else for(var o=0;o<4*t.y+1;o++)0==o%4?o>0&&t.horiz[(n-1)/2][o/4-1]?(s[o]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y)):(s[o]="|",this.c.fillRect(e.x,e.y-90,8,190),e.x+=this.step,this.c.moveTo(e.x,e.y)):(s[o]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y));0==n&&(s[1]=s[2]=s[3]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y)),2*t.x-1==n&&(s[4*t.y]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y)),i.push(s.join("")+"\r\n"),e.x=0,e.y+=this.step}console.log(i.join(""))},updateMaze:function(t,i){for(var e in this.canvases);},check:function(){},render:function(){this.coffee.render(),this.sleep.render(),this.check(),this.player.render()}};var app;window.onload=function(){app=new App,app.printVersion(),app.boot(),app.intro(),render()};var BOOT=[{o:"info",m:"initiating boot sequence.."},{o:"info",m:"version [0.0.1] -- unstable."},{o:"info",m:"checking file systems.. fsck from util-linux 2.20.1"},{o:"info",m:"...done."},{o:"info",m:"mounting local filesysyems:"},{o:"info",m:"...done."},{o:"info",m:"setting kernel variables:"},{o:"info",m:"... done."},{o:"info",m:"configuring network interfaces:"},{o:"info",m:"...done"},{o:"info",m:"starting daemons:"},{o:"info",m:"...done"},{o:"info",m:"starting secure shell server:"},{o:"info",m:"...done"},{o:"info",m:"..."},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"login: root"},{o:"info",m:"password: *********"},{o:"info",m:"\n"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"}],INTRO=[{o:"mirror",m:"Good Evening, user_42@m1r200r.."},{o:"mirror",m:"The company needs you to fight an intruder."},{o:"mirror",m:"Our fear is that one employee is having mental illness,"},{o:"mirror",m:"and he's now attempting to destroy the company."}];