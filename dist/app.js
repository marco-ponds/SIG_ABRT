function randomInt(t,i){return Math.floor(Math.random()*(i-t+1)+t)}function getMousePosition(t,i){var e=t.getBoundingClientRect();return{x:Math.round((i.clientX-e.left)/(e.right-e.left)*t.width),y:Math.round((i.clientY-e.top)/(e.bottom-e.top)*t.height)}}function Bar(t){this.element=t,this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.levels=[.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5],this.angles=[];for(var i=0;i<this.levels.length;i++)this.angles.push(randomInt(0,2)-1);this.level=.5,this.height=this.canvas.height,this.width=this.canvas.width,this._angle=0}function EnemiesHolder(t,i){this.canvas=document.querySelector("#enemies"),this.canvas.width=t,this.canvas.height=i,this.c=this.canvas.getContext("2d"),this.count=100,this.enemies=[],this.types=Object.keys(GLITCHES);for(var e=0;e<100;e++)this.enemies.push(new Enemy(this.types[Math.floor(Math.random()*this.types.length)],this.c,t,i))}function Enemy(t,i,e,s){this.life=20,this.width=e,this.height=s,this.type=t,this.c=i,this.pos={x:Math.random()*(this.width-100)+100,y:Math.random()*(this.height-100)+100}}function Player(t,i){this.canvas=document.querySelector("#player"),this.canvas.width=t,this.canvas.height=i,this.c=this.canvas.getContext("2d"),this.life=100,this.hit=50,this.pos={x:50,y:50},this.dir={x:0,y:0},this.radius=20,this.speed=1,this.angle=0,document.addEventListener("mousedown",function(t){!t.target!=this.canvas&&(this.click=getMousePosition(this.canvas,t),this.fire(),app.enemies.handleFire(this.click))}.bind(this)),document.addEventListener("mousemove",function(t){if(!t.target!=this.canvas){this.mouse=getMousePosition(this.canvas,t);var i=this._getDistance();this.dir={x:(this.mouse.x-this.pos.x)/i,y:(this.mouse.y-this.pos.y)/i};var e={x:this.pos.x+this.dir.x||0,y:this.pos.y+this.dir.y||0};this._getDistance(e)>this.radius&&this.checkPosition(e)&&this._updatePosition()}}.bind(this))}function App(){this.version="v0.0.1",this.author="Marco Stagni",this.conversation=document.querySelector("#conversation"),this.printing=!1,this.queue=[],this.canvas=document.querySelector("#game"),this.container=document.querySelector("#gameContainer"),this._canvases=this.container.querySelectorAll("canvas"),this.c=this.canvas.getContext("2d"),this.canvas.height=2500,this.canvas.width=4900,this.step=100,this.margin=200,this.container.style.height=this.canvas.height+"px;",this.container.style.width=this.canvas.width+"px;",this.coffee=new Bar("coffee"),this.sleep=new Bar("sleep"),this.player=new Player(this.canvas.width,this.canvas.height),this.enemies=new EnemiesHolder(this.canvas.width,this.canvas.height),this.maze=this.createMaze(12,12),this.drawMaze(this.maze)}function render(){app.render(),app.renderid=requestAnimationFrame(render)}var GLITCHES={invert_color:{color:"red",shape:"triangle",render:function(){},effect:function(){}},lag:{color:"green",shape:"square",render:function(){},effect:function(){}},invisible:{color:"white",shape:"circle",render:function(){this.c.clearRect(0,0,this.w,this.h),this.c.beginPath(),this.c.arc(this.pos.x,this.pos.y,10,0,2*Math.PI,!1),this.c.fillStyle="#ffffff",this.c.fill()},effect:function(){}}},GLITCHES_HUMAN={tired:{blink:function(){},wavy:function(){},wtf:function(){}},excited:{fast:function(){},colors:function(){}}};Bar.prototype={render:function(){this.ctx.clearRect(0,0,this.width,this.height);for(var t,i=5,e=15,s=0;s<this.levels.length;s++)t=this.levels[s]*this.height+5*Math.sin(this.angles[s]),this.ctx.fillStyle="rgb(255, 255, 255)",this.ctx.fillRect(e,this.height-t,i,t),e+=i+8,this.angles[s]+=.1;this.levels.shift(),this.levels.push(app[this.element].level),this._angle+=.1},inc:function(t){this.level+=t?t:.1},dec:function(t){this.level=this.level-(t?t:.1)}},EnemiesHolder.prototype={render:function(){this.c.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t in this.enemies)this.enemies[t].isAlive()?this.enemies[t].render():this.enemies.splice(t,1)},handleFire:function(t){for(var i in this.enemies)this.enemies[i]._getDistance(this.enemies[i].pos,t)<10&&this.enemies[i].hit(app.player.hit)}},Enemy.prototype={isAlive:function(){return this.life>0},_getDistance:function(t,i){var e=t||this.pos,s=i||app.player.pos;return Math.round(Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2)))},hit:function(t){this.life=this.life-t},explode:function(){GLITCHES[this.type].render.bind(this).call(),this.life=0},render:function(){var t=this._getDistance();this.dir={x:(app.player.pos.x-this.pos.x)/t,y:(app.player.pos.y-this.pos.y)/t},this.pos.x=this.pos.x+this.dir.x||0,this.pos.y=this.pos.y+this.dir.y||0,GLITCHES[this.type].render.bind(this).call(),t<20&&this.explode()}},Player.prototype={isAlive:function(){return this.life>0},_getDistance:function(t){var i=t||this.pos;return this.mouse?Math.round(Math.sqrt(Math.pow(i.x-this.mouse.x,2)+Math.pow(i.y-this.mouse.y,2))):0},_updatePosition:function(){var t=this.dir.x||0,i=this.dir.y||0;this.pos.x+=t,this.pos.y+=i,app.updateMaze(t,i)},fire:function(t){this.click&&!this.firing&&(this.firing=!0,this._drawFire(),setTimeout(function(){this.firing=!1}.bind(this),500))},_drawFire:function(){this.c.strokeStyle="#ffff00",this.c.beginPath(),this.c.moveTo(this.pos.x,this.pos.y),this.c.lineTo(this.click.x,this.click.y),this.c.lineWidth=2,this.c.stroke()},checkPosition:function(t){var i=t||this.pos;if(i.x<10||i.x>this.canvas.width)return!1;if(i.y<10||i.y>this.canvas.height)return!1;var e=app.c.getImageData(i.x,i.y,4,4).data;return e.indexOf(85)==-1},render:function(){if(this._getDistance()>this.radius&&this.checkPosition()){this._updatePosition(),this.c.clearRect(0,0,this.canvas.width,this.canvas.height),this.c.beginPath();var t=this.radius+Math.sin(this.angle);this.c.arc(this.pos.x,this.pos.y,t,0,2*Math.PI,!1),this.c.fillStyle="blue",this.c.fill(),this.angle+=.05}this.firing&&this._drawFire()}},App.prototype={printVersion:function(){var t=document.getElementById("version");t.innerText=this.version},say:function(t,i){function e(){if(s.innerHTML+=i[n],app.conversation.scrollTop=app.conversation.scrollHeight,n++,n<i.length)setTimeout(e,Math.round(80*Math.random()));else if(app.printing=!1,0!=app.queue.length){var t=app.queue.shift();app.say(t.o,t.m)}}if(this.printing)return void this.queue.push({o:t,m:i});var s=document.createElement("li");s.className=t,this.conversation.appendChild(s);var n=0;app.printing=!0,setTimeout(e,Math.round(80*Math.random()))},boot:function(){for(var t in BOOT)app.say(BOOT[t].o,BOOT[t].m)},intro:function(){for(var t in INTRO)app.say(INTRO[t].o,INTRO[t].m)},createMaze:function(t,i){var e=t*i-1;if(e<0)return void alert("illegal maze dimensions");for(var s=[],n=0;n<t+1;n++)s[n]=[],verti=[];for(var n=0;n<t+1;n++)verti[n]=[],here=[Math.floor(Math.random()*t),Math.floor(Math.random()*i)],path=[here],unvisited=[];for(var n=0;n<t+2;n++){unvisited[n]=[];for(var o=0;o<i+1;o++)unvisited[n].push(n>0&&n<t+1&&o>0&&(n!=here[0]+1||o!=here[1]+1))}for(;0<e;){for(var h=[[here[0]+1,here[1]],[here[0],here[1]+1],[here[0]-1,here[1]],[here[0],here[1]-1]],r=[],n=0;n<4;n++)unvisited[h[n][0]+1][h[n][1]+1]&&r.push(h[n]);r.length?(e-=1,next=r[Math.floor(Math.random()*r.length)],unvisited[next[0]+1][next[1]+1]=!1,next[0]==here[0]?s[next[0]][(next[1]+here[1]-1)/2]=!0:verti[(next[0]+here[0]-1)/2][next[1]]=!0,path.push(here=next)):here=path.pop()}return{x:t,y:i,horiz:s,verti:verti}},drawMaze:function(t){var i=[],e={x:0,y:0};this.c.fillStyle="#555555";for(var s=0;s<2*t.x+1;s++){var n=[];if(0==s%2)for(var o=0;o<4*t.y+1;o++)0==o%4?(n[o]="+",this.c.fillRect(e.x,e.y,8,8),e.x+=this.step,this.c.moveTo(e.x,e.y)):s>0&&t.verti[s/2-1][Math.floor(o/4)]?(n[o]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y)):(n[o]="-",this.c.fillRect(e.x-90,e.y,190,8),e.x+=this.step,this.c.moveTo(e.x,e.y));else for(var o=0;o<4*t.y+1;o++)0==o%4?o>0&&t.horiz[(s-1)/2][o/4-1]?(n[o]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y)):(n[o]="|",this.c.fillRect(e.x,e.y-90,8,190),e.x+=this.step,this.c.moveTo(e.x,e.y)):(n[o]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y));0==s&&(n[1]=n[2]=n[3]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y)),2*t.x-1==s&&(n[4*t.y]=" ",e.x+=this.step,this.c.moveTo(e.x,e.y)),i.push(n.join("")+"\r\n"),e.x=0,e.y+=this.step}console.log(i.join(""))},updateMaze:function(t,i){for(var e in this.canvases);},check:function(){},render:function(){this.coffee.render(),this.sleep.render(),this.check(),this.player.render(),this.enemies.render()}};var app;window.onload=function(){app=new App,app.printVersion(),app.boot(),app.intro(),render()};var BOOT=[{o:"info",m:"initiating boot sequence.."},{o:"info",m:"version [0.0.1] -- unstable."},{o:"info",m:"checking file systems.. fsck from util-linux 2.20.1"},{o:"info",m:"...done."},{o:"info",m:"mounting local filesysyems:"},{o:"info",m:"...done."},{o:"info",m:"setting kernel variables:"},{o:"info",m:"... done."},{o:"info",m:"configuring network interfaces:"},{o:"info",m:"...done"},{o:"info",m:"starting daemons:"},{o:"info",m:"...done"},{o:"info",m:"starting secure shell server:"},{o:"info",m:"...done"},{o:"info",m:"..."},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"login: root"},{o:"info",m:"password: *********"},{o:"info",m:"\n"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"},{o:"info",m:"_"}],INTRO=[{o:"mirror",m:"Good Evening, user_42@m1rr0r.."},{o:"mirror",m:"The company needs you to fight an intruder."},{o:"mirror",m:"Our fear is that one employee is having mental illness,"},{o:"mirror",m:"and he's now attempting to destroy the company."}];